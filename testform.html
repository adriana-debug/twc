<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Coaching Records CRUD</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      display: flex;
      height: 100vh;
    }
    .sidebar {
      width: 200px;
      background-color: #2c3e50;
      color: white;
      padding: 20px;
      box-sizing: border-box;
    }
    .sidebar h2 {
      margin-top: 0;
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
    }
    .sidebar li {
      margin: 15px 0;
      cursor: pointer;
    }
    .main {
      flex: 1;
      padding: 20px;
      box-sizing: border-box;
      overflow: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    table, th, td {
      border: 1px solid #ddd;
    }
    th, td {
      padding: 8px;
      text-align: left;
    }
    .actions button {
      margin-right: 5px;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>Menu</h2>
    <ul>
      <li id="menu-records">View Records</li>
      <li id="menu-add">Add Record</li>
    </ul>
  </div>
  <div class="main">
    <div id="view-records">
      <h1>Coaching Records</h1>
      <table id="recordsTable">
        <thead>
          <tr>
            <th>ID</th><th>Date</th><th>Coach</th><th>Employee</th>
            <th>EmployeeNumber</th><th>Performance</th><th>CoachingProvided</th>
            <th>ActionPlan</th><th>Acknowledge</th><th>SignedForm</th><th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div id="view-add" style="display: none;">
      <h1>Add / Edit Record</h1>
      <form id="recordForm">
        <div><label>ID: <input name="ID" required /></label></div>
        <div><label>Date: <input name="Date" type="date" required /></label></div>
        <div><label>Coach: <input name="Coach" /></label></div>
        <div><label>Employee: <input name="Employee" /></label></div>
        <div><label>EmployeeNumber: <input name="EmployeeNumber" /></label></div>
        <div><label>Performance: <input name="Performance" /></label></div>
        <div><label>CoachingProvided: <input name="CoachingProvided" /></label></div>
        <div><label>ActionPlan: <input name="ActionPlan" /></label></div>
        <div><label>Acknowledge: <input name="Acknowledge" /></label></div>
        <div><label>SignedForm: <input name="SignedForm" /></label></div>
        <div style="margin-top: 15px;">
          <button type="submit">Save</button>
          <button type="button" id="btnCancel">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbx7ETOJduiGR2Z7zHgbg7CV7KxV3Xq-h97MNsnf9gjgu0ClGV9tA7hnz8HIPi5HnwY4/exec"; // ← Replace with your Web App URL

    let editingId = null;

    document.getElementById('menu-records').onclick = () => {
      showView('records');
      loadRecords();
    };
    document.getElementById('menu-add').onclick = () => {
      showView('add');
      document.getElementById('recordForm').reset();
      editingId = null;
    };
    document.getElementById('btnCancel').onclick = () => {
      showView('records');
    };

    function showView(view) {
      document.getElementById('view-records').style.display = (view === 'records' ? '' : 'none');
      document.getElementById('view-add').style.display = (view === 'add' ? '' : 'none');
    }

    async function loadRecords() {
      try {
        const resp = await fetch(API_URL + "?action=read");
        const data = await resp.json();
        const tbody = document.querySelector("#recordsTable tbody");
        tbody.innerHTML = "";
        data.forEach(rec => {
          const tr = document.createElement("tr");
          ["ID","Date","Coach","Employee","EmployeeNumber","Performance",
           "CoachingProvided","ActionPlan","Acknowledge","SignedForm"].forEach(key => {
            const td = document.createElement("td");
            td.textContent = rec[key] || "";
            tr.appendChild(td);
          });
          const tdActions = document.createElement("td");
          tdActions.className = "actions";
          const btnEdit = document.createElement("button");
          btnEdit.textContent = "Edit";
          btnEdit.onclick = () => populateEdit(rec);
          tdActions.appendChild(btnEdit);
          const btnDel = document.createElement("button");
          btnDel.textContent = "Delete";
          btnDel.onclick = () => doDelete(rec.ID);
          tdActions.appendChild(btnDel);
          tr.appendChild(tdActions);
          tbody.appendChild(tr);
        });
      } catch (err) {
        console.error("Error loading records:", err);
        alert("Error loading records: " + err);
      }
    }

    function populateEdit(rec) {
      showView('add');
      editingId = rec.ID;
      const form = document.getElementById('recordForm');
      for (const key in rec) {
        if (form.elements[key]) {
          form.elements[key].value = rec[key];
        }
      }
    }

    async function doDelete(id) {
      if (!confirm("Delete record with ID " + id + "?")) return;
      try {
        const resp = await fetch(API_URL + "?action=delete&id=" + encodeURIComponent(id));
        const j = await resp.json();
        if (j.status === "ok") {
          alert("Deleted");
          loadRecords();
        } else {
          alert("Delete error: " + (j.message || JSON.stringify(j)));
        }
      } catch (err) {
        console.error("Delete error:", err);
        alert("Delete error: " + err);
      }
    }

    document.getElementById('recordForm').onsubmit = async (evt) => {
      evt.preventDefault();
      const form = evt.target;
      const rec = {};
      for (const el of form.elements) {
        if (el.name) {
          rec[el.name] = el.value;
        }
      }
      const payload = {
        action: editingId ? "update" : "create",
        record: rec
      };
      try {
        const resp = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        const j = await resp.json();
        if (j.status === "ok") {
          alert("Saved: " + j.message);
          showView('records');
          loadRecords();
        } else {
          alert("Save error: " + (j.message || JSON.stringify(j)));
        }
      } catch (err) {
        console.error("Save error:", err);
        alert("Save error: " + err);
      }
    };

    // On initial load:
    showView('records');
    loadRecords();

  </script>
</body>
</html>
